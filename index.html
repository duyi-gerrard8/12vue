<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>43</title>
    <script src="./vue.js"></script>
</head>

<body>
<div id="app">
    <!--<my-cmp v-focus></my-cmp>-->
    <!--<input type="text" v-focus:src.x.y="name" v-if="show"/>-->

    <!--<input type="text" v-myshow="show"/>-->
    <!--<input type="text" v-mymodel="content"/>{{ content }}-->

    <input type="text" v-slice:[slicenum].number="content"/>{{ content }}
</div>

<script>
    // 使用时：v-on v-bind:src v-model  v-
    // 全局
    Vue.directive(
        'focus', {
            //bind只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。
            bind(el, binding, vnode) {
                // console.log('bind');
                console.log(el);
                console.log(binding.name);
                console.log(binding.value);
                console.log(binding.expression);
                console.log(binding.arg);
                console.log(binding.modifiers);
                console.log(vnode.context);
                // el.focus();
            },
            inserted(el) {//此钩子函数是在被插入到父元素时即执行
                console.log('inserted');
                // el.focus()
            },
            //update,所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。
            update() {
                console.log('update');
            },
            componentUpdated() {
                console.log('componentUpdated');
            },
            unbind() {
                console.log('unbind');
            },
        }
    );

    Vue.component(
        'my-cmp', {
            template: `
                <div><p>mr deng is a p</p></div>
            `
        }
    );

    // 模拟v-show
    // show -> true -> 显示
    // show -> false -> 隐藏 display: none
    Vue.directive('myshow', {
        bind(el, binding) {
            const {value} = binding;
            const display = value ? '' : 'none';
            el.style.display = display;
        },
        update(el, binding) {
            const {value} = binding;
            const display = value ? '' : 'none';
            el.style.display = display;
        },
    });

    // v-model
    // 1. 通过绑定的数据，给元素设置value
    // 2. 当触发input事件时，更改绑定的数据值
    // 3. 更改数据后，同步input的value值
    Vue.directive('mymodel', {
        bind(el, binding, vnode) {
            const vm = vnode.context;//元素绑定的实例
            const {value, expression} = binding;
            el.value = value;

            el.oninput = function () {
                const inputVal = el.value; //取得输入框中的值
                vm[expression] = inputVal; //元素所绑定实例对象的值
            }
        },
        update(el, binding) {
            const {value} = binding;
            el.value = value;
        }
    });

    // 截取input框内的文字
    // v-slice:5.number
    /*Vue.directive('slice', {
        bind(el, binding, vnode) {
            const vm = vnode.context;//元素绑定的实例
            let {value, expression, arg, modifiers} = binding;
            arg = arg || 5;
            if (modifiers.number) {
                value = value.replace(/[^0-9]/g, '');
            }
            el.value = value.slice(0, arg);
            vm[expression] = value.slice(0, arg);

            el.oninput = function () {
                let {value} = el; //取得输入框中的值
                if (modifiers.number) {
                    value = value.replace(/[^0-9]/g, '');
                }
                vm[expression] = value.slice(0, arg); //元素所绑定实例对象的值
                el.value = value.slice(0, arg);
            }
        },
        update(el, binding, vnode) {
            let {value, expression, arg, modifiers} = binding;
            arg = arg || 5;
            if (modifiers.number) {
                value = value.replace(/[^0-9]/g, '');
            }
            const vm = vnode.context;
            el.value = value.slice(0, arg);
            vm[expression] = value.slice(0, arg);

            el.oninput = function () {
                let {value} = el; //取得输入框中的值
                if (modifiers.number) {
                    value = value.replace(/[^0-9]/g, '');
                }
                vm[expression] = value.slice(0, arg); //元素所绑定实例对象的值
                el.value = value.slice(0, arg);
            }
        },
    });*/

    //函数简写
    Vue.directive('slice', (el, binding, vnode) => {
        const vm = vnode.context;//元素绑定的实例
        let {value, expression, arg, modifiers} = binding;
        arg = arg || 5;
        if (modifiers.number) {
            value = value.replace(/[^0-9]/g, '');
        }
        el.value = value.slice(0, arg);
        vm[expression] = value.slice(0, arg);

        el.oninput = function () {
            let {value} = el; //取得输入框中的值
            if (modifiers.number) {
                value = value.replace(/[^0-9]/g, '');
            }
            vm[expression] = value.slice(0, arg); //元素所绑定实例对象的值
            el.value = value.slice(0, arg);
        }
    });

    const vm = new Vue({
        el: '#app',
        data: {
            name: 'shanshan',
            show: false,
            content: 'shanshan',
            slicenum: 3
        },
        //自定义指令，局部
        // directives: {
        //     // focus: {
        //     // ...
        //     // }
        // },
    })
</script>
</body>

</html>
